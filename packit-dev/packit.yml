container_prefix: packit

protect_data: true

repo: ghcr.io/mrc-ide

network: packit

vault:
  addr: https://vault.dide.ic.ac.uk:8200
  auth:
    method: github

volumes:
  proxy_logs: packit-proxy-logs
  proxy_tls: packit-proxy-tls
  orderly_library: packit-orderly-library
  orderly_logs: packit-orderly-logs

instances:
  reside-dev:
    volumes:
      outpack: packit-outpack-reside-dev
      packit_db: packit-db-reside-dev

    outpack:
      server:
        name: outpack_server
        tag: main

    packit:
      base_url: https://reside-dev.packit-dev.dide.ic.ac.uk/
      api:
        name: packit-api
        tag: main
      app:
        name: packit
        tag: main
      db:
        name: packit-db
        tag: main
        user: packituser
        password: changeme
      auth:
        enabled: true
        auth_method: github
        expiry_days: 7
        github_api_org: reside-ic
        github_api_team: "" # blank means anyone in the org
        github_client:
          id: VAULT:secret/packit/oauth/dev:clientId
          secret: VAULT:secret/packit/oauth/dev:clientSecret
        oauth2:
          redirect:
            packit_api_root: "https://reside-dev.packit-dev.dide.ic.ac.uk/api"
            url: "https://reside-dev.packit-dev.dide.ic.ac.uk/redirect"
        jwt:
          secret: VAULT:secret/packit/jwtsecret/dev:value

      default_roles: ["ADMIN"]
      cors_allowed_origins: "https://reside-dev.packit-dev.dide.ic.ac.uk/"

      runner:
        git:
          url: https://github.com/reside-ic/packit-infra-test-repo.git

orderly-runner:
  image:
    name: orderly.runner
    tag: main
  workers: 2

proxy:
  enabled: true
  hostname: packit-dev.dide.ic.ac.uk
  port_http: 80
  port_https: 443
  image:
    name: packit-proxy
    tag: multipackit

acme_buddy:
  image:
    repo: ghcr.io/reside-ic
    name: acme-buddy
    tag: main
  email: reside@imperial.ac.uk
  dns_provider: hdb
  env:
    HDB_ACME_USERNAME: VAULT:secret/certbot-hdb/credentials:username
    HDB_ACME_PASSWORD: VAULT:secret/certbot-hdb/credentials:password

  port: 2112
