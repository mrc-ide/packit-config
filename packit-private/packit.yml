container_prefix: packit

protect_data: true

repo: ghcr.io/mrc-ide

network: packit

vault:
  addr: https://vault.dide.ic.ac.uk:8200
  auth:
    method: github

volumes:
  proxy_logs: packit-proxy-logs
  proxy_tls: packit-proxy-tls
  orderly_library: packit-orderly-library
  orderly_logs: packit-orderly-logs

instances:
  kipling:
    volumes:
      outpack: packit-outpack-kipling
      packit_db: packit-db-kipling

    outpack:
      server:
        name: outpack_server
        tag: main

    packit:
      base_url: https://kipling.packit-private.dide.ic.ac.uk/
      api:
        name: packit-api
        tag: main
      app:
        name: packit
        tag: main
      db:
        name: packit-db
        tag: main
        user: packituser
        password: changeme
      auth:
        enabled: true
        auth_method: github
        expiry_days: 7
        github_api_org: mrc-ide
        github_api_team: kipling
        github_client:
          id: VAULT:secret/packit/oauth/private:clientId
          secret: VAULT:secret/packit/oauth/private:clientSecret
        oauth2:
          redirect:
            packit_api_root: "https://kipling.packit-private.dide.ic.ac.uk/api"
            url: "https://kipling.packit-private.dide.ic.ac.uk/redirect"
        jwt:
          secret: VAULT:secret/packit/jwtsecret/private:value

      default_roles: "ADMIN"
      cors_allowed_origins: "https://kipling.packit-private.dide.ic.ac.uk/"

proxy:
  enabled: true
  hostname: packit-private.dide.ic.ac.uk
  port_http: 80
  port_https: 443
  port_metrics: 9000
  image:
    name: packit-proxy
    tag: main

acme_buddy:
  image:
    repo: ghcr.io/reside-ic
    name: acme-buddy
    tag: main
  email: reside@imperial.ac.uk
  dns_provider: hdb
  env:
    HDB_ACME_USERNAME: VAULT:secret/certbot-hdb/credentials:username
    HDB_ACME_PASSWORD: VAULT:secret/certbot-hdb/credentials:password

  port: 2112
